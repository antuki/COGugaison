<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Agréger des données à des échelons supra-communaux — nivsupra • COGugaison</title>

<!-- favicons -->
<link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png" />
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png" />
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png" />
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png" />

<!-- jquery -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
<!-- Bootstrap -->

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous" />

<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script>

<!-- bootstrap-toc -->
<link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script>

<!-- Font Awesome icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous" />

<!-- clipboard.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script>

<!-- headroom.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script>

<!-- pkgdown -->
<link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script>




<meta property="og:title" content="Agréger des données à des échelons supra-communaux — nivsupra" />
<meta property="og:description" content="Permettre d'agréger les tables de données communales à de nombreux échelons supra-communaux administratifs (EPCI, arrondissements, cantons-villes, départements, régions) ou d'étude (bassins de vie, zones d'emploi, unités urbaines, aires urbaines). La fonction `nivsupra` peut également s'appliquer à des tables de flux (non agrégées par codes communes) grâce à l'option agregation = FALSE. La table en entrée est alors conservée comme telle avec une nouvelle colonne qui correspond au niveau supracommunal du code commune considéré." />
<meta property="og:image" content="/logo.png" />




<!-- mathjax -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->



  </head>

  <body data-spy="scroll" data-target="#toc">
    <div class="container template-reference-topic">
      <header>
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">COGugaison</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">1.0.5</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="../articles/COGugaison.html">Introduction à COGugaison</a>
</li>
<li>
  <a href="../reference/index.html">Documentation des fonctions</a>
</li>
<li>
  <a href="../news/index.html">Nouveautés</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="http://github.com/antuki/COGugaison/">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
      
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header>

<div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Agréger des données à des échelons supra-communaux</h1>
    <small class="dont-index">Source: <a href='http://github.com/antuki/COGugaison/blob/master/R/nivsupra.R'><code>R/nivsupra.R</code></a></small>
    <div class="hidden name"><code>nivsupra.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>Permettre d'agréger les tables de données communales à de nombreux échelons supra-communaux administratifs (EPCI, arrondissements, cantons-villes, départements, régions) ou d'étude (bassins de vie, zones d'emploi, unités urbaines, aires urbaines). La fonction `nivsupra` peut également s'appliquer à des tables de flux (non agrégées par codes communes) grâce à l'option agregation = FALSE. La table en entrée est alors conservée comme telle avec une nouvelle colonne qui correspond au niveau supracommunal du code commune considéré.</p>
    </div>

    <pre class="usage"><span class='fu'>nivsupra</span><span class='op'>(</span>
  <span class='va'>table_entree</span>,
  codgeo_entree <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/colnames.html'>colnames</a></span><span class='op'>(</span><span class='va'>table_entree</span><span class='op'>)</span><span class='op'>[</span><span class='fl'>1</span><span class='op'>]</span>,
  COG <span class='op'>=</span> <span class='va'>annee_ref</span>,
  var_num <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/colnames.html'>colnames</a></span><span class='op'>(</span><span class='va'>table_entree</span><span class='op'>)</span><span class='op'>[</span><span class='fu'><a href='https://rdrr.io/r/base/lapply.html'>sapply</a></span><span class='op'>(</span><span class='va'>table_entree</span>, <span class='va'>is.numeric</span><span class='op'>)</span><span class='op'>]</span>,
  <span class='va'>nivsupra</span>,
  nivsupra_nom <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/ifelse.html'>ifelse</a></span><span class='op'>(</span><span class='va'>agregation</span> <span class='op'>==</span> <span class='cn'>TRUE</span>, <span class='va'>nivsupra</span>, <span class='fu'><a href='https://rdrr.io/r/base/paste.html'>paste0</a></span><span class='op'>(</span><span class='va'>nivsupra</span>, <span class='st'>"_"</span>,
    <span class='va'>codgeo_entree</span><span class='op'>)</span><span class='op'>)</span>,
  agregation <span class='op'>=</span> <span class='cn'>T</span>
<span class='op'>)</span></pre>

    <h2 class="hasAnchor" id="arguments"><a class="anchor" href="#arguments"></a>Arguments</h2>
    <table class="ref-arguments">
    <colgroup><col class="name" /><col class="desc" /></colgroup>
    <tr>
      <th>table_entree</th>
      <td><p>correspond à la table (ou le vecteur, cf. paramètre vecteur_entree) à transformer de manière à modifier les codes des communes corses.</p></td>
    </tr>
    <tr>
      <th>codgeo_entree</th>
      <td><p>est une chaîne de caractères qui indique le nom de la variable contenant les codes communes Insee. Par défaut, il s'agit du nom de la première colonne de table_entree.</p></td>
    </tr>
    <tr>
      <th>COG</th>
      <td><p>indique l'année de COG de la table communale considérée. (exemple 2014). Années possibles : de 2008 à 2020. Par défaut, vaut 2020.</p></td>
    </tr>
    <tr>
      <th>var_num</th>
      <td><p>est un vecteur de chaînes de caractères qui indique les noms des variables numériques à convertir. Par défaut, il s'agit de l'ensemble des variables de types numériques dans table_entree.</p></td>
    </tr>
    <tr>
      <th>nivsupra</th>
      <td><p>est une chaîne de caractères qui indique le nom du niveau supra-communale souhaité. Pour les années récentes :
- "DEP" : départements
- "REG" : régions
- "EPCI" : EPCI au 01/01/20XX
- "ARR" : arrondissements au 01/01/20XX
- "CV" : cantons-villes au 01/01/20XX
- "ZE2010" : zones d'emploi 2010 (avant 2020)
- "ZE2020" : zones d'emploi 2020 (après 2020)
- "UU2010" : unités urbaines 2010 (avant 2020)
- "UU2020" : unités urbaines 2020 (après 2020)
- "AU2010" : aires urbaines 2010 (avant 2020)
- "AAV2020" : aires d'attraction des villes 2020 (après 2020)
- "BV2012" : bassins de vie 2012
Pour les COG plus anciens, regarder au cas par cas selon les années. Par exemple, str(table_supracom_2008)</p></td>
    </tr>
    <tr>
      <th>nivsupra_nom</th>
      <td><p>indique le nom à donner au niveau supra-communal dans la table de sortie. Il faut par défaut la chaîne de caractère contenue dans nivsupra si agregation = T et la concaténation de nivsupra et codgeo_entree séparée d'un "_" si agregation = F.</p></td>
    </tr>
    <tr>
      <th>agregation</th>
      <td><p>vaut TRUE si la table souhaitée doit sommer toutes les lignes qui concernent une même commune et FALSE si l'on souhaite volontairement conserver les doublons dans les codes commune (dans les tables de flux par exemple). Si agregation = F, les variables de type caractère sont alors conservées comme telles ou dupliquées en cas de défusion et les variables numériques sommées en cas de fusion ou réparties proportionnellement à la population de chaque commune en cas de défusion.</p></td>
    </tr>
    </table>

    <h2 class="hasAnchor" id="details"><a class="anchor" href="#details"></a>Details</h2>

    <p>Le code officiel géographique le plus récent du package est actuellement celui au 01/01/2022. <br /></p>
<p>Les millésimes des COG qui peuvent être utilisés sont à ce stade les suivants : 1968, 1975, 1982, 1990, 1999, 2008 à 2022. <br /></p>
<p>A partir de 2020, de nombreux zonages ont été modifiés suite à la refonte des zonages de l'Insee. Les ZE2010 deviennent les ZE2020, les UU2010 deviennent les UU2020, les AU2010 deviennent les AAV2020.</p>
<p>Les dates de référence des codes officiels géographiques utilisés dans COGugaison sont les suivantes :</p><ul>
<li><p>COG 1968 : à partir du 01/03/1968</p></li>
<li><p>COG 1975 : à partir du 20/02/1975</p></li>
<li><p>COG 1982 : à partir du 04/03/1982</p></li>
<li><p>COG 1990 : à partir du 05/03/1990</p></li>
<li><p>COG 1999 : à partir du 08/03/1999</p></li>
<li><p>Pour tous les autres COG : à partir du 01/01 de chaque année</p></li>
</ul><p><br /></p>
<p>Les différences entre les tables de passage Insee et non Insee sont les suivantes :<br /></p><ul>
<li><p>1982-03-03 (pris en compte par l'Insee seulement après le 04/03/1982): Flaignes-Havys (08169) est un rassemblement de Flaignes-Havys (08169), Havys (08221) [fusion simple].</p></li>
<li><p>2014-01-01 (pris en compte par l'Insee seulement au 01/01/2015) : Loisey (55298) s'est séparée en Loisey (55298), Culey (55138) [rétablissement].</p></li>
<li><p>1990-02-01 (pris en compte par l'Insee seulement après le 05/03/1990) : Le code commune de Oudon passe de 14624 à 14697 [changement de code dû à un changement de chef-lieu].</p></li>
<li><p>2014-01-07 (pris en compte par l'Insee  dès le 01/01/2016) : Tôtes est rattachée à Notre-Dame-de-Fresnay qui devient L'Oudon (changement de code de l'Oudon de 14697 à 14472) [transfert de chef-lieu].</p></li>
<li><p>1981-09-28 (pris en compte par l'Insee  dès le 20/02/1975) : Vaudreuil-Ex-Ensemble Urbain (27701) est créée à partir des parcelles d'Incarville (27351), de Léry (27365) , de Porte-Joie (27471) , de Poses  (27474) , de Saint-Étienne-du-Vauvray (27537), de Saint-Pierre-du-Vauvray (27598), de Tournedos-sur-Seine  (27651) et du Vaudreuil (27528) [création]. Cette situation étant complexe, nous avons pour le moment considéré que Vaudreuil-Ex-Ensemble Urbain (27701) est créée à partir de parcelles du Vaudreuil (27528) uniquement.</p></li>
<li><p>En 1968, les 4 communes qui auraient dû d'après le COG être codées 2B044,2B076,2B151 et 2A325 sont codées 20044,20076,20151 et 20325 dans les données Insee.</p></li>
</ul>

    <h2 class="hasAnchor" id="references"><a class="anchor" href="#references"></a>References</h2>

    
<ul>
<li><p><a href='https://www.insee.fr/fr/information/2666684#titre-bloc-11'>historique des géographies communales (Insee)</a></p></li>
<li><p><a href='https://www.insee.fr/fr/information/2028028'>tables d'appartenance des communes aux différents niveaux géographiques (Insee)</a></p></li>
</ul>

    <h2 class="hasAnchor" id="see-also"><a class="anchor" href="#see-also"></a>See also</h2>

    <div class='dont-index'><p><a href='changement_COG_varNum.html'>changement_COG_varNum</a>, <a href='changement_COG_typo.html'>changement_COG_typo</a>,<a href='changement_COG_typo_details.html'>changement_COG_typo_details</a>, <a href='COG_akinator.html'>COG_akinator</a>, <a href='enlever_PLM.html'>enlever_PLM</a>, <a href='modification_Corse.html'>modification_Corse</a>,<a href='modifications_communales.html'>modifications_communales</a>,<a href='apparier_COG.html'>apparier_COG</a>,<a href='modification_Oudon.html'>modification_Oudon</a>,<a href='trajectoire_commune.html'>trajectoire_commune</a></p></div>

    <h2 class="hasAnchor" id="examples"><a class="anchor" href="#examples"></a>Examples</h2>
    <pre class="examples"><div class='input'><span class='co'>## Exemple 1</span>
<span class='co'># Ici, apres avoir transforme les donnees en geographie communale au 01/01/2017, nous agregeons la population et la superficie des communes a l'echelon geographique des zones d'emploi afin d'obtenir une table des densites de population par zone d'emploi.</span>
<span class='va'>exemple_popcom_COG2017_num</span> <span class='op'>&lt;-</span> <span class='fu'><a href='changement_COG_varNum.html'>changement_COG_varNum</a></span><span class='op'>(</span>table_entree<span class='op'>=</span><span class='va'>exemple_popcom</span>,annees<span class='op'>=</span><span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>2014</span><span class='op'>:</span><span class='fl'>2017</span><span class='op'>)</span>,agregation<span class='op'>=</span><span class='cn'>T</span>,libgeo<span class='op'>=</span><span class='cn'>T</span>,donnees_insee<span class='op'>=</span><span class='cn'>T</span><span class='op'>)</span>
<span class='va'>exemple_popcom_ZE2010</span> <span class='op'>&lt;-</span> <span class='fu'>nivsupra</span><span class='op'>(</span>table_entree<span class='op'>=</span><span class='va'>exemple_popcom_COG2017_num</span>,COG<span class='op'>=</span><span class='fl'>2017</span>,nivsupra<span class='op'>=</span><span class='st'>"ZE2010"</span>,agregation<span class='op'>=</span><span class='cn'>T</span><span class='op'>)</span>
<span class='va'>exemple_popcom_ZE2010</span><span class='op'>$</span><span class='va'>densite</span> <span class='op'>&lt;-</span> <span class='va'>exemple_popcom_ZE2010</span><span class='op'>$</span><span class='va'>P12_POP</span> <span class='op'>/</span> <span class='va'>exemple_popcom_ZE2010</span><span class='op'>$</span><span class='va'>SUPERF</span>
<span class='fu'><a href='https://rdrr.io/r/utils/head.html'>head</a></span><span class='op'>(</span><span class='va'>exemple_popcom_ZE2010</span><span class='op'>)</span>
</div><div class='output co'>#&gt;   ZE2010                         LIBGEO P12_POP SUPERF  densite
#&gt; 1   0050                 Mont-de-Marsan  160717   4956 32.42877
#&gt; 2   0051                        Alençon  122263   2405 50.83701
#&gt; 3   0052                Cosne - Clamecy   75052   2553 29.39757
#&gt; 4   0053                          Mâcon  143358   1543 92.90862
#&gt; 5   0054               Nogent-le-Rotrou   48665   1227 39.66178
#&gt; 6   0055 La Vallée de la Bresle - Vimeu   99095   1134 87.38536</div><div class='input'><span class='co'>## Exemple 2</span>
<span class='co'># Ici, on ajoute les colonnes ZE2010_COMMUNE et ZE2010_DCLT a la table exemple de flux domicile-travail.</span>
<span class='va'>exemple_flux_COG2017</span> <span class='op'>&lt;-</span> <span class='fu'><a href='changement_COG_varNum.html'>changement_COG_varNum</a></span><span class='op'>(</span>table_entree<span class='op'>=</span><span class='va'>exemple_flux</span>,annees<span class='op'>=</span><span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>2014</span><span class='op'>:</span><span class='fl'>2017</span><span class='op'>)</span>,codgeo_entree<span class='op'>=</span><span class='st'>"COMMUNE"</span>,agregation<span class='op'>=</span><span class='cn'>F</span>,libgeo<span class='op'>=</span><span class='cn'>F</span>,donnees_insee<span class='op'>=</span><span class='cn'>T</span><span class='op'>)</span>
<span class='va'>exemple_flux_COG2017</span> <span class='op'>&lt;-</span> <span class='fu'><a href='changement_COG_varNum.html'>changement_COG_varNum</a></span><span class='op'>(</span>table_entree<span class='op'>=</span><span class='va'>exemple_flux_COG2017</span>,annees<span class='op'>=</span><span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>2014</span><span class='op'>:</span><span class='fl'>2017</span><span class='op'>)</span>,codgeo_entree<span class='op'>=</span><span class='st'>"DCLT"</span>,agregation<span class='op'>=</span><span class='cn'>F</span>,libgeo<span class='op'>=</span><span class='cn'>F</span>,donnees_insee<span class='op'>=</span><span class='cn'>T</span><span class='op'>)</span>
<span class='va'>exemple_flux_COG2017_etZE</span> <span class='op'>&lt;-</span> <span class='fu'>nivsupra</span><span class='op'>(</span>table_entree<span class='op'>=</span><span class='va'>exemple_flux_COG2017</span>,codgeo_entree<span class='op'>=</span><span class='st'>"COMMUNE"</span>,nivsupra<span class='op'>=</span><span class='st'>"ZE2010"</span>,COG<span class='op'>=</span><span class='fl'>2017</span>,agregation<span class='op'>=</span><span class='cn'>F</span><span class='op'>)</span>
<span class='va'>exemple_flux_COG2017_etZE</span> <span class='op'>&lt;-</span> <span class='fu'>nivsupra</span><span class='op'>(</span>table_entree<span class='op'>=</span><span class='va'>exemple_flux_COG2017_etZE</span>,codgeo_entree<span class='op'>=</span><span class='st'>"DCLT"</span>,nivsupra<span class='op'>=</span><span class='st'>"ZE2010"</span>,COG<span class='op'>=</span><span class='fl'>2017</span>,agregation<span class='op'>=</span><span class='cn'>F</span><span class='op'>)</span>
<span class='fu'><a href='https://rdrr.io/r/utils/head.html'>head</a></span><span class='op'>(</span><span class='va'>exemple_flux_COG2017_etZE</span><span class='op'>)</span>
</div><div class='output co'>#&gt;   COMMUNE  DCLT CS1 AGEREVQ   IPONDI ZE2010_COMMUNE ZE2010_nom_COMMUNE
#&gt; 1   61001 61001   4      25 2.856389           0051            Alençon
#&gt; 2   61001 61001   3      55 3.040441           0051            Alençon
#&gt; 3   61213 53185   2      45 4.142349           0051            Alençon
#&gt; 4   61464 61001   5      35 4.059227           0051            Alençon
#&gt; 5   61491 61500   6      15 5.578419           0051            Alençon
#&gt; 6   61117 61117   2      45 3.945892           0051            Alençon
#&gt;   ZE2010_DCLT ZE2010_nom_DCLT
#&gt; 1        0051         Alençon
#&gt; 2        0051         Alençon
#&gt; 3        0051         Alençon
#&gt; 4        0051         Alençon
#&gt; 5        0051         Alençon
#&gt; 6        0051         Alençon</div></pre>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top">
      <h2 data-toc-skip>Contents</h2>
    </nav>
  </div>
</div>


      <footer>
      <div class="copyright">
  <p>Developed by Kim Antunez.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
   </div>

  


  </body>
</html>


